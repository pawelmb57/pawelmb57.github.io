<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fort Myers Open Houses</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRS9BMY="
     crossorigin=""/>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Custom scrollbar for the sidebar */
        .listing-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .listing-scroll::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .listing-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        .listing-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        /* Map height calculation to fill screen minus header */
        #map {
            height: 50vh;
            width: 100%;
            z-index: 1;
        }

        @media (min-width: 768px) {
            #map {
                height: calc(100vh - 80px); /* Full height minus header */
            }
        }

        .card-active {
            border-left: 4px solid #3b82f6;
            background-color: #eff6ff;
        }
    </style>
</head>
<body class="bg-gray-50 h-screen flex flex-col overflow-hidden">

    <!-- Header / Filter Bar -->
    <header class="bg-white shadow-md z-20 p-4 shrink-0 h-[80px] flex items-center justify-between">
        <div class="flex items-center gap-2">
            <i class="fa-solid fa-map-location-dot text-blue-600 text-2xl"></i>
            <h1 class="text-xl font-bold text-gray-800 hidden sm:block">Fort Myers Hunt</h1>
        </div>

        <!-- Filters -->
        <div class="flex gap-2 sm:gap-4 overflow-x-auto">
            <div class="flex items-center gap-2">
                <label class="text-sm text-gray-600 hidden sm:block">Max Price:</label>
                <select id="priceFilter" class="border border-gray-300 rounded px-2 py-1 text-sm focus:outline-none focus:border-blue-500">
                    <option value="1000000">Any Price</option>
                    <option value="600000">$600k</option>
                    <option value="500000">$500k</option>
                    <option value="400000">$400k</option>
                </select>
            </div>

            <div class="flex items-center gap-2">
                <label class="text-sm text-gray-600 hidden sm:block">Date:</label>
                <select id="dateFilter" class="border border-gray-300 rounded px-2 py-1 text-sm focus:outline-none focus:border-blue-500">
                    <option value="all">All Dates</option>
                    <option value="Sat Oct 28">Sat Oct 28</option>
                    <option value="Sun Oct 29">Sun Oct 29</option>
                </select>
            </div>
            
            <button onclick="applyFilters()" class="bg-blue-600 text-white px-4 py-1 rounded text-sm hover:bg-blue-700 transition">
                Filter
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex flex-col-reverse md:flex-row flex-1 overflow-hidden relative">
        
        <!-- Sidebar Listing View -->
        <div class="w-full md:w-1/3 lg:w-1/4 bg-white shadow-lg z-10 overflow-y-auto listing-scroll" id="listings-container">
            <!-- Listings will be injected here via JS -->
        </div>

        <!-- Map View -->
        <div class="w-full md:w-2/3 lg:w-3/4 relative bg-gray-200">
            <div id="map"></div>
        </div>

    </div>

    <script>
        // --- DATA ---
        // Mock data for 3 listings around Fort Myers, FL
        const listings = [
            {
                id: 1,
                title: "River District Modern Condo",
                price: 450000,
                address: "2300 First St, Fort Myers, FL 33901",
                beds: 2,
                baths: 2,
                sqft: 1200,
                openDate: "Sat Oct 28",
                openTime: "10:00 AM - 2:00 PM",
                image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?auto=format&fit=crop&q=80&w=400",
                lat: 26.6436,
                lng: -81.8723, // Downtown
                desc: "Stunning views of the Caloosahatchee River."
            },
            {
                id: 2,
                title: "Colonial Blvd Family Home",
                price: 525000,
                address: "4500 Colonial Blvd, Fort Myers, FL 33966",
                beds: 4,
                baths: 3,
                sqft: 2400,
                openDate: "Sat Oct 28",
                openTime: "1:00 PM - 4:00 PM",
                image: "https://images.unsplash.com/photo-1564013799919-ab600027ffc6?auto=format&fit=crop&q=80&w=400",
                lat: 26.6033,
                lng: -81.8210, // Mid-town
                desc: "Spacious backyard with pool, perfect for families."
            },
            {
                id: 3,
                title: "McGregor Blvd Historic Cottage",
                price: 385000,
                address: "1500 McGregor Blvd, Fort Myers, FL 33901",
                beds: 3,
                baths: 2,
                sqft: 1800,
                openDate: "Sun Oct 29",
                openTime: "11:00 AM - 3:00 PM",
                image: "https://images.unsplash.com/photo-1568605114967-8130f3a36994?auto=format&fit=crop&q=80&w=400",
                lat: 26.6300,
                lng: -81.8800, // McGregor area
                desc: "Charming historic architecture with modern updates."
            }
        ];

        // --- STATE ---
        let map;
        let markers = {};
        let activeId = null;

        // --- INIT MAP ---
        function initMap() {
            // Center on Fort Myers
            map = L.map('map').setView([26.6406, -81.8723], 12);

            // Add OpenStreetMap Tile Layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            renderListings(listings);
        }

        // --- RENDER FUNCTIONS ---
        
        // 1. Render Markers and Sidebar Cards
        function renderListings(data) {
            const container = document.getElementById('listings-container');
            container.innerHTML = ''; // Clear sidebar
            
            // Clear existing markers from map
            for (let id in markers) {
                map.removeLayer(markers[id]);
            }
            markers = {};

            if (data.length === 0) {
                container.innerHTML = '<div class="p-8 text-center text-gray-500">No listings found matching your filters.</div>';
                return;
            }

            data.forEach(item => {
                // A. Add Marker to Map
                const marker = L.marker([item.lat, item.lng]).addTo(map);
                
                // Add popup
                marker.bindPopup(`
                    <div class="text-center">
                        <strong class="block text-gray-800">${item.title}</strong>
                        <div class="text-blue-600 font-bold">$${item.price.toLocaleString()}</div>
                    </div>
                `);

                // Marker Click Event
                marker.on('click', () => {
                    highlightListing(item.id);
                    scrollToCard(item.id);
                });

                markers[item.id] = marker;

                // B. Add Card to Sidebar
                const card = document.createElement('div');
                card.id = `listing-${item.id}`;
                card.className = "cursor-pointer border-b border-gray-100 hover:bg-gray-50 transition p-4 flex gap-4";
                card.onclick = () => {
                    highlightListing(item.id);
                    // Fly to location on map
                    map.flyTo([item.lat, item.lng], 14, {
                        animate: true,
                        duration: 1.5
                    });
                    markers[item.id].openPopup();
                };

                card.innerHTML = `
                    <div class="w-24 h-24 shrink-0 rounded-lg overflow-hidden bg-gray-200">
                        <img src="${item.image}" alt="${item.title}" class="w-full h-full object-cover">
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-gray-800 truncate">${item.title}</h3>
                            <span class="text-blue-600 font-bold text-sm">$${(item.price / 1000).toFixed(0)}k</span>
                        </div>
                        <p class="text-xs text-gray-500 mb-1"><i class="fa-solid fa-location-dot mr-1"></i>${item.address}</p>
                        
                        <div class="flex gap-3 text-xs text-gray-600 mb-2">
                            <span><i class="fa-solid fa-bed"></i> ${item.beds}bd</span>
                            <span><i class="fa-solid fa-bath"></i> ${item.baths}ba</span>
                            <span><i class="fa-solid fa-ruler-combined"></i> ${item.sqft} sqft</span>
                        </div>

                        <div class="bg-blue-50 text-blue-800 text-xs px-2 py-1 rounded inline-block">
                            <i class="fa-regular fa-clock mr-1"></i> ${item.openDate} • ${item.openTime}
                        </div>
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // --- INTERACTION ---

        function highlightListing(id) {
            // Remove active class from previous
            if (activeId) {
                const prevCard = document.getElementById(`listing-${activeId}`);
                if (prevCard) prevCard.classList.remove('card-active');
            }

            // Add active class to current
            const currCard = document.getElementById(`listing-${id}`);
            if (currCard) {
                currCard.classList.add('card-active');
                activeId = id;
            }
        }

        function scrollToCard(id) {
            const card = document.getElementById(`listing-${id}`);
            if (card) {
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // --- FILTERING ---

        function applyFilters() {
            const maxPrice = document.getElementById('priceFilter').value;
            const selectedDate = document.getElementById('dateFilter').value;

            const filtered = listings.filter(item => {
                const matchesPrice = item.price <= parseInt(maxPrice);
                const matchesDate = selectedDate === 'all' || item.openDate === selectedDate;
                return matchesPrice && matchesDate;
            });

            renderListings(filtered);
            
            // Recenter map to fit bounds of new markers if any exist
            if (filtered.length > 0) {
                const group = new L.featureGroup(filtered.map(i => markers[i.id]));
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        // Initialize App
        window.onload = initMap;

    </script>
</body>
</html>
